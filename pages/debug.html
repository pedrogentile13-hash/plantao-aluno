<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug - Banco de Dados</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: #1e293b;
            color: #e2e8f0;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            color: #60a5fa;
            margin-bottom: 30px;
            text-align: center;
            font-size: 32px;
        }

        .section {
            background: #334155;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        h2 {
            color: #34d399;
            font-size: 24px;
        }

        .btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn:hover {
            background: #2563eb;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #ef4444;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-success {
            background: #10b981;
        }

        .btn-success:hover {
            background: #059669;
        }

        pre {
            background: #1e293b;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            border: 2px solid #475569;
            color: #fbbf24;
            font-size: 13px;
            line-height: 1.6;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: #1e293b;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #475569;
            text-align: center;
        }

        .stat-value {
            font-size: 36px;
            font-weight: 700;
            color: #60a5fa;
            margin-bottom: 8px;
        }

        .stat-label {
            color: #94a3b8;
            font-size: 14px;
        }

        .actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .info-box {
            background: #1e3a8a;
            border-left: 4px solid #3b82f6;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
        }

        .warning-box {
            background: #7c2d12;
            border-left: 4px solid #ea580c;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            background: #1e293b;
        }

        table th,
        table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #475569;
        }

        table th {
            background: #475569;
            color: #60a5fa;
            font-weight: 600;
        }

        .back-link {
            display: inline-block;
            margin-bottom: 20px;
            color: #60a5fa;
            text-decoration: none;
            font-weight: 600;
        }

        .back-link:hover {
            color: #3b82f6;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
        }

        .btn-warning {
            background: #f59e0b;
        }

        .btn-warning:hover {
            background: #d97706;
        }

        select {
            background: #1e293b;
            color: #e2e8f0;
            border: 2px solid #475569;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
        }

        select:hover {
            border-color: #60a5fa;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-link">‚Üê Voltar para o site</a>

        <h1>üóÑÔ∏è Banco de Dados - LocalStorage</h1>

        <div class="info-box">
            <strong>‚ÑπÔ∏è Informa√ß√£o:</strong> Este painel mostra todos os dados armazenados no LocalStorage do navegador.
        </div>

        <!-- Estat√≠sticas -->
        <div class="section">
            <h2>üìä Estat√≠sticas Gerais</h2>
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-value" id="totalUsers">0</div>
                    <div class="stat-label">Total de Usu√°rios</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalResumos">0</div>
                    <div class="stat-label">Resumos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalVideos">0</div>
                    <div class="stat-label">Videoaulas</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalSimulados">0</div>
                    <div class="stat-label">Simulados</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalResults">0</div>
                    <div class="stat-label">Resultados</div>
                </div>
            </div>
        </div>

        <!-- Usu√°rios -->
        <div class="section">
            <div class="section-header">
                <h2>üë• Usu√°rios Cadastrados</h2>
                <button class="btn" onclick="toggleSection('usersData')">Mostrar/Ocultar JSON</button>
            </div>
            <div class="info-box">
                <strong>‚ö° Controles Dispon√≠veis:</strong>
                <ul style="margin-top: 10px; margin-left: 20px;">
                    <li><strong>Ano:</strong> Altere o ano escolar do usu√°rio (8¬∫ ou 9¬∫ ano)</li>
                    <li><strong>Plano:</strong> Altere o plano do usu√°rio diretamente na tabela (Gr√°tis, B√°sico, Premium)</li>
                    <li><strong>Admin:</strong> Torne qualquer usu√°rio admin ou remova o status de admin</li>
                    <li><strong>Excluir:</strong> Remova permanentemente um usu√°rio do banco de dados</li>
                </ul>
            </div>
            <div id="usersTable"></div>
            <pre id="usersData" style="display: none;"></pre>
        </div>

        <!-- Conte√∫do -->
        <div class="section">
            <div class="section-header">
                <h2>üìö Conte√∫do do Site</h2>
                <button class="btn" onclick="toggleSection('contentData')">Mostrar/Ocultar</button>
            </div>
            <pre id="contentData" style="display: none;"></pre>
        </div>

        <!-- Resultados -->
        <div class="section">
            <div class="section-header">
                <h2>üìä Resultados dos Simulados</h2>
                <button class="btn" onclick="toggleSection('resultsData')">Mostrar/Ocultar</button>
            </div>
            <div id="resultsTable"></div>
            <pre id="resultsData" style="display: none;"></pre>
        </div>

        <!-- A√ß√µes -->
        <div class="section">
            <h2>‚öôÔ∏è A√ß√µes</h2>
            <div class="warning-box">
                <strong>‚ö†Ô∏è Aten√ß√£o:</strong> As a√ß√µes abaixo s√£o irrevers√≠veis!
            </div>
            <div class="actions">
                <button class="btn btn-success" onclick="exportData()">üì• Exportar Dados (JSON)</button>
                <button class="btn" onclick="reloadData()">üîÑ Recarregar Dados</button>
                <button class="btn btn-danger" onclick="clearDatabase()">üóëÔ∏è Limpar Banco de Dados</button>
            </div>
        </div>
    </div>

    <script src="../js/database.js"></script>
    <script>
        function loadDebugData() {
            // Estat√≠sticas
            const users = DB.getUsers();
            const content = DB.getContent();
            const results = DB.getResults();

            document.getElementById('totalUsers').textContent = users.length;
            document.getElementById('totalResumos').textContent = content.resumos.length;
            document.getElementById('totalVideos').textContent = content.videoaulas.length;
            document.getElementById('totalSimulados').textContent = content.simulados.length;
            document.getElementById('totalResults').textContent = results.length;

            // Usu√°rios - Tabela com controles de edi√ß√£o
            let usersTable = `
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Nome</th>
                            <th>Email</th>
                            <th>Ano</th>
                            <th>Plano</th>
                            <th>Admin</th>
                            <th>Cadastro</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            users.forEach(user => {
                usersTable += `
                    <tr>
                        <td>${user.id}</td>
                        <td>${user.name}</td>
                        <td>${user.email}</td>
                        <td>
                            <select onchange="changeSchoolYear(${user.id}, this.value)">
                                <option value="8" ${user.schoolYear === '8' ? 'selected' : ''}>8¬∫ ano</option>
                                <option value="9" ${user.schoolYear === '9' ? 'selected' : ''}>9¬∫ ano</option>
                            </select>
                        </td>
                        <td>
                            <select onchange="changePlan(${user.id}, this.value)">
                                <option value="gratis" ${user.plan === 'gratis' ? 'selected' : ''}>Gr√°tis</option>
                                <option value="basico" ${user.plan === 'basico' ? 'selected' : ''}>B√°sico</option>
                                <option value="premium" ${user.plan === 'premium' ? 'selected' : ''}>Premium</option>
                            </select>
                        </td>
                        <td>
                            <select onchange="toggleAdmin(${user.id}, this.value === 'true')">
                                <option value="true" ${user.isAdmin ? 'selected' : ''}>‚úÖ Sim</option>
                                <option value="false" ${!user.isAdmin ? 'selected' : ''}>‚ùå N√£o</option>
                            </select>
                        </td>
                        <td>${new Date(user.createdAt).toLocaleString('pt-BR')}</td>
                        <td>
                            <button class="btn btn-small btn-danger" onclick="deleteUser(${user.id})">üóëÔ∏è Excluir</button>
                        </td>
                    </tr>
                `;
            });

            usersTable += `</tbody></table>`;
            document.getElementById('usersTable').innerHTML = usersTable;

            // Usu√°rios - JSON
            document.getElementById('usersData').textContent = JSON.stringify(users, null, 2);

            // Conte√∫do - JSON
            document.getElementById('contentData').textContent = JSON.stringify(content, null, 2);

            // Resultados - Tabela
            let resultsTable = `
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>User ID</th>
                            <th>Simulado ID</th>
                            <th>Mat√©ria</th>
                            <th>Bimestre</th>
                            <th>Nota</th>
                            <th>Acertos</th>
                            <th>Data</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            results.forEach(result => {
                resultsTable += `
                    <tr>
                        <td>${result.id}</td>
                        <td>${result.userId}</td>
                        <td>${result.simuladoId}</td>
                        <td>${result.materia}</td>
                        <td>${result.bimestre}¬∫</td>
                        <td><strong>${result.nota.toFixed(1)}</strong></td>
                        <td>${result.acertos}/${result.totalQuestoes}</td>
                        <td>${new Date(result.date).toLocaleString('pt-BR')}</td>
                    </tr>
                `;
            });

            resultsTable += `</tbody></table>`;
            document.getElementById('resultsTable').innerHTML = resultsTable;

            // Resultados - JSON
            document.getElementById('resultsData').textContent = JSON.stringify(results, null, 2);
        }

        function toggleSection(id) {
            const element = document.getElementById(id);
            element.style.display = element.style.display === 'none' ? 'block' : 'none';
        }

        function reloadData() {
            loadDebugData();
            alert('‚úÖ Dados recarregados!');
        }

        function exportData() {
            const data = {
                users: DB.getUsers(),
                content: DB.getContent(),
                results: DB.getResults(),
                exportDate: new Date().toISOString()
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `plantaoaluno_backup_${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);

            alert('‚úÖ Dados exportados com sucesso!');
        }

        function clearDatabase() {
            if (confirm('‚ö†Ô∏è ATEN√á√ÉO!\n\nIsso vai apagar TODOS os dados do banco!\n\nTem certeza?')) {
                if (confirm('üö® √öLTIMA CONFIRMA√á√ÉO!\n\nRealmente deseja limpar tudo?\n\n(Isso n√£o pode ser desfeito)')) {
                    localStorage.clear();
                    alert('‚úÖ Banco de dados limpo!\n\nA p√°gina ser√° recarregada.');
                    location.reload();
                }
            }
        }

        function changeSchoolYear(userId, newYear) {
            const user = DB.getUsers().find(u => u.id === userId);
            if (!user) return;

            DB.updateUser(userId, { schoolYear: newYear });

            // Se for o usu√°rio logado, atualizar tamb√©m
            const currentUser = DB.getCurrentUser();
            if (currentUser && currentUser.id === userId) {
                DB.updateCurrentUser({ schoolYear: newYear });
            }

            alert(`‚úÖ Ano escolar de ${user.name} alterado para: ${newYear}¬∫ ano`);
            loadDebugData();
        }

        function changePlan(userId, newPlan) {
            const user = DB.getUsers().find(u => u.id === userId);
            if (!user) return;

            DB.updateUser(userId, { plan: newPlan });

            // Se for o usu√°rio logado, atualizar tamb√©m
            const currentUser = DB.getCurrentUser();
            if (currentUser && currentUser.id === userId) {
                DB.updateCurrentUser({ plan: newPlan });
            }

            alert(`‚úÖ Plano de ${user.name} alterado para: ${newPlan.toUpperCase()}`);
            loadDebugData();
        }

        function toggleAdmin(userId, isAdmin) {
            const user = DB.getUsers().find(u => u.id === userId);
            if (!user) return;

            DB.updateUser(userId, { isAdmin: isAdmin });

            // Se for o usu√°rio logado, atualizar tamb√©m
            const currentUser = DB.getCurrentUser();
            if (currentUser && currentUser.id === userId) {
                DB.updateCurrentUser({ isAdmin: isAdmin });
            }

            const status = isAdmin ? 'ADMIN' : 'USU√ÅRIO NORMAL';
            alert(`‚úÖ ${user.name} agora √©: ${status}`);
            loadDebugData();
        }

        function deleteUser(userId) {
            const user = DB.getUsers().find(u => u.id === userId);
            if (!user) return;

            if (confirm(`‚ö†Ô∏è Excluir usu√°rio?\n\nNome: ${user.name}\nEmail: ${user.email}\n\nEsta a√ß√£o n√£o pode ser desfeita!`)) {
                // Verificar se n√£o est√° tentando excluir o usu√°rio logado
                const currentUser = DB.getCurrentUser();
                if (currentUser && currentUser.id === userId) {
                    alert('‚ùå Voc√™ n√£o pode excluir o usu√°rio que est√° logado!\n\nFa√ßa logout primeiro.');
                    return;
                }

                DB.deleteUser(userId);
                alert(`‚úÖ Usu√°rio ${user.name} exclu√≠do com sucesso!`);
                loadDebugData();
            }
        }

        // Carregar dados ao iniciar
        loadDebugData();
    </script>
</body>
</html>
